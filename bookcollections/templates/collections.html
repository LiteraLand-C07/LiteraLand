{% extends 'base.html' %}


{% block meta %}
<title>MyCollections</title>
{% endblock meta %}


{% block link %}
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
<style>
    body {
        font-family: 'Roboto', sans-serif;
        background-color: rgb(86, 85, 85);
    }

    .nav-link:hover {
    color: #ffffff; /* Atur ke warna yang Anda inginkan */
    }
</style>
{% endblock link %}


{% block content %}

<!-- NAVBAR -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container-fluid">
        <a class="navbar-brand text-white" href="#">
            <i class="bi bi-journal-bookmark-fill"></i>
            LiteraLand
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link my-2 my-lg-0" href="">Browse Book</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link my-2 my-lg-0" href="">Recommendation</a>
                </li>
                <!-- DISPLAY IF IN GUEST MODE -->
                <li class="nav-item">
                    <a class="nav-link my-2 my-lg-0" href="">Logout</a>
                </li>
            </ul>
        </div>
    </div>
</nav>


<!-- HEADER HALAMAN  -->
<h1 class="text-white text-center mt-4">MyCollections</h1>
<div class="container my-4">
<div class="mb-3 d-flex align-items-center">
    <label class="me-3 mb-0 text-white">
        Filter by Status Baca:
        <div id="status_filter" name="status_filter" role="group" class="mt-2 d-flex flex-row gap-2 flex-wrap">
            <button type="button" class="btn btn-warning" value="all">All</button>
            <button type="button" class="btn btn-primary" value="C">Completed</button>
            <button type="button" class="btn btn-success" value="R">Reading</button>
            <button type="button" class="btn btn-danger" value="D">Dropped</button>
            <button type="button" class="btn btn-secondary" value="PR">Plan to Read</button>
        </div>
    </label>
</div>




<!-- DAFTAR KOLEKSI -->
<div id="card-deck" class="row">
    {% for collection in book_collections %}
    <div class="col-md-6 card-container" data-status-baca="{{ collection.status_baca }}">
        <div class="card mb-4 text-bg-dark">
            <div class="row g-0">
                <div class="col-md-4">
                    <img src="" class="img-fluid rounded-start thumbnail" alt="{{ collection.book.title }} cover" data-isbn="{{collection.book.ISBN}}" style="width: 100%;height: 100%;;">
                </div>
                <div class="col-md-8">
                    <div class="card-body">
                        <h5 class="card-title">{{ collection.book.title }}</h5>
                        <p class="card-text">Author: {{ collection.book.author }}</p>
                        <p class="card-text">Genre : {{collection.book.genre}}</p>
                        <p class="card-text">Page : {{collection.current_page}}/{{collection.book.page_count}}</p>
                        <p class="card-text">Rating : <span class="badge bg-warning text-dark">{{ collection.rating }}</span></p>
                        <p class="card-text">Status : {{collection.get_status_baca_display}}</p>
                        <div class="d-flex flex-wrap flex-row justify-content-start gap-3" id="button-collection">
                            <button class="btn btn-outline-light btn-sm" data-bs-toggle="modal" data-bs-target="#exampleModal"">Edit</button>
                            <button class="btn btn-outline-light btn-sm">Read</button>
                            <button class="btn btn-outline-light btn-sm">Delete</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
</div>


<!-- MODAL TO EDIT COLLECTIONS -->
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content font-monospace fw-bold">
            <div class="modal-header" id="modal-header"></div>
            <div class="modal-body">
                <form id="form-collection" onsubmit="return false;">
                    {% csrf_token %}
                    <div class="mb-3">
                        <label for="rating" class="col-form-label">Rating:</label>
                        <select class="form-control" id="rating" name="rating"></select>
                    </div>
                    <div class="mb-3">
                        <label for="current_page" class="col-form-label">Page:</label>
                        <input type="number" class="form-control" id="current_page" name="current_page" value=""></input>
                    </div>
                    <div class="mb-3">
                      <label for="status_baca" class="col-form-label">Status:</label>
                      <select class="form-control" id="status_baca" name="status_baca"></select>
                    </div>
                </form>
            </div>
            <div class="modal-footer" id="modal-footer"></div>
        </div>
    </div>
</div>

<script>

    function getCover() {
        var thumbnails = document.querySelectorAll('.thumbnail');
        thumbnails.forEach(function(thumbnail) {
            var isbn = thumbnail.getAttribute('data-isbn');
            const url = 'https://www.googleapis.com/books/v1/volumes?q=isbn:' + isbn;
            fetch(url, {
                method: 'GET',
            }).then(response => response.json())
                .then(response => handleResponse(response, thumbnail))
        });
    }

    function handleResponse(response, thumbnail) {
        var item = response.items[0];
        var thumb = item.volumeInfo.imageLinks.thumbnail;
        let imgZoom = thumb.replace('zoom=1', 'zoom=6')
        let imgHttps = imgZoom.replace('http', 'https');
        thumbnail.setAttribute('src', imgHttps);
    }

    getCover();

    function addFilterHandler(){
        // Dapatkan semua tombol
        var buttons = document.getElementById('status_filter').getElementsByTagName('button');

        // Tambahkan event handler untuk setiap tombol
        for (var i = 0; i < buttons.length; i++) {
            buttons[i].addEventListener('click', function() {
                var selectedStatus = this.value;
                var cards = document.getElementsByClassName('card-container');
                for (var i = 0; i < cards.length; i++) {
                    var card = cards[i];
                    if (selectedStatus === "all" || card.getAttribute('data-status-baca') === selectedStatus) {
                        card.style.display = 'block';
                    } else {
                        card.style.display = 'none';
                    }
                }
            });
        }
    }

    addFilterHandler()
</script>
  
{% endblock %}
